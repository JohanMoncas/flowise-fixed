import{a3 as ue,s as ge,M as Z,R as je,u as be,a as ke,b as E,ac as ye,r as i,x as ve,y as Ce,ah as R,ai as L,j as e,S as we,B as d,ae as Se,T as h,c as X,g as Ie,a9 as De,aa as Pe,w,I as S,K as Ee,L as Re}from"./index-gS4G3Zvm.js";import{R as Me}from"./main-Oq92Vsfh.js";import{S as Ne}from"./StyledButton-BezdNUdt.js";import{B as Fe}from"./BackdropLoader-BXfMzoOO.js";import{D as U}from"./DocStoreInputHandler-BJZFY-d7.js";import{D as Te}from"./Dropdown-Pxw99ybs.js";import{S as M}from"./StyledFab-Dj7dhm3q.js";import{E as Be}from"./ErrorBoundary-DgWpKdHq.js";import{E as Oe}from"./ExpandedChunkDialog-BtD50vKw.js";import{n as Q}from"./nodes-D-c9NxXo.js";import{d as I}from"./documentstore-B_2l-CO4.js";import{v as V}from"./v4-D8aEg3BZ.js";import{I as $e}from"./IconArrowLeft-DFIApZne.js";import{I as Ae}from"./IconDatabaseImport-BWzHXKXH.js";import{G as j}from"./Grid-D-37Cj0I.js";import{T as qe}from"./TextField-CaTYCeBV.js";import{I as We}from"./IconScissors-CPrMZJPY.js";import{S as u}from"./IconPlus-AGtwgm1M.js";import{I as Y}from"./IconEye-CSz221uw.js";import{O as ze}from"./OutlinedInput-D4_GfAeK.js";import"./CircularProgress-DZaOwk-q.js";import"./MultiDropdown-l8yKJNGl.js";import"./FormControl-DRZbBJsp.js";import"./CredentialInputHandler-DLneV5-k.js";import"./CredentialListDialog-whgYGMZs.js";import"./TooltipWithParser-QjR1RSOD.js";import"./IconSearch-bTWMcRjI.js";import"./ConfirmDialog-B77l_AWh.js";import"./Input-VmClTvg5.js";import"./Popover--3As_8sE.js";import"./ManageScrapedLinksDialog-BCRwQYUt.js";import"./Delete-Bz2MR18H.js";import"./DataGrid-BYvxOVVy.js";import"./toPropertyKey-hKuLU48H.js";import"./Menu-gkL-szGu.js";import"./CodeEditor-DHC33Fid.js";import"./IconTrash-B5rbIrMz.js";import"./File-Bk6PFwL_.js";import"./IconCopy-DAc54BlI.js";import"./IconLanguage-DSDXbUhN.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ge=ue("outline","book","IconBook",[["path",{d:"M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-0"}],["path",{d:"M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-1"}],["path",{d:"M3 6l0 13",key:"svg-2"}],["path",{d:"M12 6l0 13",key:"svg-3"}],["path",{d:"M21 6l0 13",key:"svg-4"}]]);const He=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Je(n){return typeof n=="string"&&He.test(n)}const Ke=ge(Z)(({theme:n})=>({background:n.palette.card.main,color:n.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:n.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),Nt=()=>{var J,K;const n=je(t=>t.customization),N=be(),_=ke(),c=E(Q.getSpecificNode),p=E(Q.getNodesByCategory),m=E(I.getSpecificDocumentStore),{storeId:D,name:b}=ye(),[r,ee]=i.useState({}),[F,x]=i.useState(!1),[T,P]=i.useState(null),[B,O]=i.useState(""),[k,te]=i.useState([]),[$,ae]=i.useState([]),[o,y]=i.useState({}),[f,se]=i.useState([]),[re,oe]=i.useState(0),[ie,ne]=i.useState(0),[A,le]=i.useState(20),[l,de]=i.useState(),[ce,q]=i.useState(!1),[pe,me]=i.useState({}),W=ve();Ce();const v=(...t)=>W(Ee(...t)),C=(...t)=>W(Re(...t)),fe=t=>{const a=(k??[]).find(s=>s.name===t);y(a||{})},he=(t,a)=>{me({data:{selectedChunk:t,selectedChunkNumber:a}}),q(!0)},z=()=>{let t=!0;const a=(r.inputParams??[]).filter(s=>!s.hidden);for(const s of a)if(!s.optional&&(!r.inputs[s.name]||!r.credential)){if(s.type==="credential"&&!r.credential){t=!1;break}else if(s.type!=="credential"&&!r.inputs[s.name]){t=!1;break}}return t||v({message:"Please fill in all mandatory fields.",options:{key:new Date().getTime()+Math.random(),variant:"warning",action:s=>e.jsx(w,{style:{color:"white"},onClick:()=>C(s),children:e.jsx(S,{})})}}),t},G=async()=>{if(z()){x(!0);const t=H();t.previewChunkCount=A;try{const a=await I.previewChunks(t);a.data&&(oe(a.data.totalChunks),se(a.data.chunks),ne(a.data.previewChunkCount)),x(!1)}catch(a){x(!1),v({message:`Failed to preview chunks: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:s=>e.jsx(w,{style:{color:"white"},onClick:()=>C(s),children:e.jsx(S,{})})}})}}},xe=async()=>{var t;if(z()){x(!0);const a=H();try{const s=await I.saveProcessingLoader(a);x(!1),s.data&&(v({message:"File submitted for processing. Redirecting to Document Store..",options:{key:new Date().getTime()+Math.random(),variant:"success",action:g=>e.jsx(w,{style:{color:"white"},onClick:()=>C(g),children:e.jsx(S,{})})}}),I.processLoader(a,(t=s.data)==null?void 0:t.id),N("/document-stores/"+D))}catch(s){x(!1),v({message:`Failed to process chunking: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:g=>e.jsx(w,{style:{color:"white"},onClick:()=>C(g),children:e.jsx(S,{})})}})}}},H=()=>{const t={};if(l?(t.loaderId=l.loaderId,t.id=l.id):t.loaderId=b,t.storeId=D,t.loaderName=B||(r==null?void 0:r.label),r.inputs&&(t.loaderConfig={},Object.keys(r.inputs).map(a=>{t.loaderConfig[a]=r.inputs[a]})),o.inputs&&o.name&&Object.keys(o).length>0){t.splitterId=o.name,t.splitterConfig={},Object.keys(o.inputs).map(s=>{t.splitterConfig[s]=o.inputs[s]});const a=k.find(s=>s.name===o.name);a&&(t.splitterName=a.label)}return r.credential&&(t.credential=r.credential),t};return i.useEffect(()=>{Je(b)?m.request(D):c.request(b)},[]),i.useEffect(()=>{if(c.data){const t=R.cloneDeep(L(c.data,V()));l&&l.loaderConfig&&(t.inputs=l.loaderConfig,O(l.loaderName)),ee(t),t.inputAnchors.find(s=>s.name==="textSplitter")&&p.request("Text Splitters")}},[c.data]),i.useEffect(()=>{if(p.data){const t=[];for(const s of p.data)t.push(R.cloneDeep(L(s,V())));te(t);const a=p.data.map(s=>({label:s.label,name:s.name}));if(a.unshift({label:"None",name:"none"}),ae(a),l&&l.splitterConfig&&l.splitterId){const s=t.find(g=>g.name===l.splitterId);s?(s.inputs=R.cloneDeep(l.splitterConfig),y(s)):y({})}}},[p.data]),i.useEffect(()=>{var t;if(m.data&&((t=m.data)==null?void 0:t.loaders.length)>0){const a=m.data.loaders.find(s=>s.id===b);a&&(de(a),c.request(a.loaderId))}},[m.data]),i.useEffect(()=>{m.error&&P(m.error)},[m.error]),i.useEffect(()=>{c.error&&P(c.error)},[c.error]),i.useEffect(()=>{p.error&&P(p.error)},[p.error]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:T?e.jsx(Be,{error:T}):e.jsxs(we,{flexDirection:"column",children:[e.jsx(d,{sx:{flexGrow:1,py:1.25,width:"100%"},children:e.jsxs(Se,{disableGutters:!0,sx:{p:0,display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",flexDirection:"row"},children:[e.jsx(M,{size:"small",color:"secondary","aria-label":"back",title:"Back",onClick:()=>N(-1),children:e.jsx($e,{})}),e.jsx(h,{sx:{ml:2,mr:2},variant:"h3",children:r==null?void 0:r.label}),e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:r!=null&&r.name?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:(r==null?void 0:r.name)??"docloader",src:`${X}/api/v1/node-icon/${r==null?void 0:r.name}`}):e.jsx(Ge,{color:"black"})})]}),e.jsx(d,{children:e.jsx(Ne,{variant:"contained",onClick:xe,sx:{borderRadius:2,height:"100%"},startIcon:e.jsx(Ae,{}),children:"Process"})})]})}),e.jsx(d,{children:e.jsxs(j,{container:!0,spacing:"2",children:[e.jsx(j,{item:!0,xs:4,md:6,lg:6,sm:4,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:15},children:[e.jsx(d,{sx:{p:2},children:e.jsx(qe,{fullWidth:!0,sx:{mt:1},size:"small",label:(J=r==null?void 0:r.label)!=null&&J.toLowerCase().includes("loader")?r.label+" name":(r==null?void 0:r.label)+" Loader Name",value:B,onChange:t=>O(t.target.value)})}),r&&Object.keys(r).length>0&&(r.inputParams??[]).filter(t=>!t.hidden).map((t,a)=>e.jsx(U,{inputParam:t,data:r},a)),k&&k.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:2,mt:5},children:[e.jsx(h,{sx:{mr:2},variant:"h3",children:((K=($??[]).find(t=>t.name===(o==null?void 0:o.name)))==null?void 0:K.label)??"Select Text Splitter"}),e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:o!=null&&o.name?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:(o==null?void 0:o.name)??"textsplitter",src:`${X}/api/v1/node-icon/${o==null?void 0:o.name}`}):e.jsx(We,{color:"black"})})]}),e.jsxs(d,{sx:{p:2},children:[e.jsx(h,{children:"Splitter"}),e.jsx(Te,{name:"textSplitter",options:$,onSelect:t=>fe(t),value:(o==null?void 0:o.name)??"none"},JSON.stringify(o))]})]}),Object.keys(o).length>0&&(o.inputParams??[]).filter(t=>!t.hidden).map((t,a)=>e.jsx(U,{data:o,inputParam:t},a))]})}),e.jsxs(j,{item:!0,xs:8,md:6,lg:6,sm:8,children:[!f||f.length===0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsxs(d,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:Ie,children:[e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160})]}),e.jsx("div",{style:{position:"absolute",top:0,right:0,width:"100%",height:"100%",backdropFilter:"blur(1px)",background:"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(M,{color:"secondary","aria-label":"preview",title:"Preview",variant:"extended",onClick:G,children:[e.jsx(Y,{style:{marginRight:"5px"}}),"Preview Chunks"]})})]}),f&&f.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{sx:{wordWrap:"break-word",textAlign:"left",mb:2},variant:"h3",children:[ie," of ",re," Chunks"]}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(h,{children:"Show Chunks in Preview"}),e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsx(ze,{size:"small",multiline:!1,sx:{mt:1,flex:1,mr:2},type:"number",onChange:t=>le(t.target.value),value:A??25},"previewChunkCount"),e.jsxs(M,{color:"secondary","aria-label":"preview",title:"Preview",variant:"extended",onClick:G,children:[e.jsx(Y,{style:{marginRight:"5px"}}),"Preview"]})]})]}),e.jsx("div",{style:{height:"800px",overflow:"scroll",padding:"5px"},children:e.jsx(j,{container:!0,spacing:2,children:f==null?void 0:f.map((t,a)=>e.jsx(j,{item:!0,lg:6,md:6,sm:6,xs:6,children:e.jsx(Ke,{content:!1,onClick:()=>he(t,a+1),sx:{border:1,borderColor:_.palette.grey[900]+25,borderRadius:2},children:e.jsx(De,{children:e.jsxs(Pe,{sx:{p:1},children:[e.jsx(h,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${a+1}. Characters: ${t.pageContent.length}`}),e.jsx(h,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(Me,{theme:n.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata,name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:1})]})})})},a))})})]})]})]})})]})}),e.jsx(Oe,{show:ce,isReadOnly:!0,dialogProps:pe,onCancel:()=>q(!1)}),F&&e.jsx(Fe,{open:F})]})};export{Nt as default};
