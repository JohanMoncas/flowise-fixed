import{s as R,aJ as z,P as a,R as M,r as i,j as t,B as F,T,aU as J,c as $}from"./index-gS4G3Zvm.js";import{c as v,A as k,C as U}from"./CredentialListDialog-whgYGMZs.js";import{b as V,A as q,T as H}from"./TextField-CaTYCeBV.js";import{C as G}from"./CircularProgress-DZaOwk-q.js";import{I as K,a as Q}from"./IconSearch-bTWMcRjI.js";const W=R(z)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${V.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),X=async({name:l,nodeData:r})=>{var c;const C=(c=r.inputParams.find(d=>d.name===l))==null?void 0:c.loadMethod,m=localStorage.getItem("username"),u=localStorage.getItem("password");return await J.post(`${$}/api/v1/node-load-method/${r.name}`,{...r,loadMethod:C},{auth:m&&u?{username:m,password:u}:void 0,headers:{"Content-type":"application/json","x-request-from":"internal"}}).then(async function(d){return d.data}).catch(function(d){console.error(d)})},E=({name:l,nodeData:r,value:C,onSelect:m,isCreateNewOption:u,onCreateNew:y,credentialNames:c=[],disabled:d=!1,freeSolo:S=!1,disableClearable:P=!1,multiple:g=!1})=>{const j=M(n=>n.customization),[h,w]=i.useState(!1),[x,D]=i.useState([]),[N,A]=i.useState(!1),I=(n=[],e)=>{if(g){let s=[];return e!=="choose an option"&&e&&typeof e=="string"?s=JSON.parse(e):s=e,n.filter(f=>s.includes(f.name))}return n.find(s=>s.name===e)},O=()=>g?[]:"",B=[{label:"- Create New -",name:"-create-"}];let[o,p]=i.useState(C??"choose an option");const b=async()=>{try{let n="";c.length>1?n=c.join("&credentialName="):n=c[0];const e=await v.getCredentialsByName(n);if(e.data){const s=[];for(let f=0;f<e.data.length;f+=1){const L={label:e.data[f].name,name:e.data[f].id};s.push(L)}return s}}catch(n){console.error(n)}};return i.useEffect(()=>{A(!0),(async()=>(async()=>{let e=c.length?await b():await X({name:l,nodeData:r});D(u?[...e,...B]:[...e]),A(!1)})())()},[]),t.jsx(t.Fragment,{children:t.jsx(q,{id:l,freeSolo:S,disabled:d,disableClearable:P,multiple:g,filterSelectedOptions:g,size:"small",sx:{mt:1,width:"100%"},open:h,onOpen:()=>{w(!0)},onClose:()=>{w(!1)},options:x,value:I(x,o)||O(),onChange:(n,e)=>{if(g){let s="";if(e.length){const f=e.map(L=>L.name);s=JSON.stringify(f)}p(s),m(s)}else{const s=e?e.name:"";u&&s==="-create-"?y():(p(s),m(s))}},PopperComponent:W,loading:N,renderInput:n=>t.jsx(H,{...n,value:o,InputProps:{...n.InputProps,endAdornment:t.jsxs(i.Fragment,{children:[N?t.jsx(G,{color:"inherit",size:20}):null,n.InputProps.endAdornment]})},sx:{height:"100%","& .MuiInputBase-root":{height:"100%"}}}),renderOption:(n,e)=>t.jsx(F,{component:"li",...n,children:t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx(T,{variant:"h5",children:e.label}),e.description&&t.jsx(T,{sx:{color:j.isDarkMode?"#9e9e9e":""},children:e.description})]})})})})};E.propTypes={name:a.string,nodeData:a.object,value:a.string,onSelect:a.func,onCreateNew:a.func,disabled:a.bool,freeSolo:a.bool,credentialNames:a.array,disableClearable:a.bool,isCreateNewOption:a.bool,multiple:a.bool};const Y=({inputParam:l,data:r,onSelect:C,disabled:m=!1})=>{const u=i.useRef(null),[y,c]=i.useState((r==null?void 0:r.credential)??""),[d,S]=i.useState(!1),[P,g]=i.useState({}),[j,h]=i.useState(!1),[w,x]=i.useState({}),[D,N]=i.useState(Date.now().toString()),A=o=>{x({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",credentialId:o}),h(!0)},I=async()=>{try{let o="";l.credentialNames.length>1?o=l.credentialNames.join("&"):o=l.credentialNames[0];const p=await v.getSpecificComponentCredential(o);if(p.data)if(Array.isArray(p.data)){const b={title:"Add New Credential",componentsCredentials:p.data};g(b),S(!0)}else{const b={type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:p.data};x(b),h(!0)}}catch(o){console.error(o)}},O=(o="")=>{c(o),N(Date.now().toString()),x({}),h(!1),C(o)},B=o=>{S(!1),x({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:o}),h(!0)};return i.useEffect(()=>{c((r==null?void 0:r.credential)??"")},[r]),t.jsxs("div",{ref:u,children:[l&&t.jsx(t.Fragment,{children:l.type==="credential"&&t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsx(E,{disabled:m,name:l.name,nodeData:r,value:y??"choose an option",isCreateNewOption:!0,credentialNames:l.credentialNames,onSelect:o=>{c(o),C(o)},onCreateNew:()=>I(l.name)}),y&&t.jsx(K,{title:"Edit",color:"primary",size:"small",onClick:()=>A(y),children:t.jsx(Q,{})})]},D)}),j&&t.jsx(k,{show:j,dialogProps:w,onCancel:()=>h(!1),onConfirm:O}),d&&t.jsx(U,{show:d,dialogProps:P,onCancel:()=>S(!1),onCredentialSelected:B})]})};Y.propTypes={inputParam:a.object,data:a.object,onSelect:a.func,disabled:a.bool};export{E as A,Y as C};
